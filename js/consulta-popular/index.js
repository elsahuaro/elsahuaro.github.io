"use strict";function _createForOfIteratorHelper(a,b){var c;if("undefined"==typeof Symbol||null==a[Symbol.iterator]){if(Array.isArray(a)||(c=_unsupportedIterableToArray(a))||b&&a&&"number"==typeof a.length){c&&(a=c);var d=0,e=function(){};return{s:e,n:function n(){return d>=a.length?{done:!0}:{done:!1,value:a[d++]}},e:function e(a){throw a},f:e}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var f,g=!0,h=!1;return{s:function s(){c=a[Symbol.iterator]()},n:function n(){var a=c.next();return g=a.done,a},e:function e(a){h=!0,f=a},f:function f(){try{g||null==c.return||c.return()}finally{if(h)throw f}}}}function _unsupportedIterableToArray(a,b){if(a){if("string"==typeof a)return _arrayLikeToArray(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);return"Object"===c&&a.constructor&&(c=a.constructor.name),"Map"===c||"Set"===c?Array.from(a):"Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c)?_arrayLikeToArray(a,b):void 0}}function _arrayLikeToArray(a,b){(null==b||b>a.length)&&(b=a.length);for(var c=0,d=Array(b);c<b;c++)d[c]=a[c];return d}var data=!1,data_uts=!1,data_mesas=!1,map=!1,sidebar=!1,secLayer=!1,mesasLayer=!1,selectedSec=!1,selectedLayer=!1,otherSelected=!1,defFilter="todos",tipo="uts",alfa=0;function initMap(){map=L.map("map"),map.setView([29.1026,-110.97732],7),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:18,attribution:"Map data &copy; OpenStreetMap contributors"}).addTo(map),sidebar=L.control.sidebar({container:"sidebar",autopan:!0}).addTo(map),map.on("click",function(){resetSelection()}),sidebar.open("datos")}function resetSelection(){undoSelection();var a=document.getElementById("sec-table");a.innerHTML=""}function undoSelection(){if(selectedLayer){selectedLayer.setStyle(dispatchStyle()({properties:selectedSec}));var a,b=_createForOfIteratorHelper(utToSecLayers[selectedLayer.feature.properties.ut]||[]);try{for(b.s();!(a=b.n()).done;){var c=a.value;c.setStyle(dispatchStyle()({properties:c.feature.properties}))}}catch(a){b.e(a)}finally{b.f()}}selectedSec=!1,selectedLayer=!1}function doSelection(){if(selectedLayer&&(selectedLayer.setStyle({color:"#ffff00",weight:4}),"tsecs"==tipo)){var a,b=_createForOfIteratorHelper(utToSecLayers[selectedLayer.feature.properties.ut]);try{for(b.s();!(a=b.n()).done;){var c=a.value;c.setStyle({color:"#ffff00",weight:4})}}catch(a){b.e(a)}finally{b.f()}}}initMap(),window.addEventListener("load",function(){fetch("/data/unidades_territoriales_data.json").then(function(a){return a.json()}).then(function(a){fetch("/data/secciones_cp_data.json").then(function(a){return a.json()}).then(function(b){fetch("/data/mesas_receptoras_data.json").then(function(a){return a.json()}).then(function(c){document.getElementById("def-select").value="todos",document.getElementById("tipo-select").value="uts",document.getElementById("alpha-select").value="0",setupData(a,b,c),setupMap(),setupBaseMap()})})})});function setupData(a,b,c){data=b,data_uts=a,data_mesas=c}function setupMap(){map||initMap(),map&&secLayer&&mesasLayer&&(map.removeLayer(secLayer),map.removeLayer(mesasLayer))}var utToSecLayers={};function setupBaseMap(){secLayer=L.geoJSON("uts"==tipo?data_uts:data,{style:dispatchStyle(),filter:dispatchFilter(),onEachFeature:callbackInstall()}).addTo(map),mesasLayer=L.geoJSON(data_mesas,{pointToLayer:function pointToLayer(a,b){return L.circleMarker(b,{radius:4,fillColor:"#ff0078",color:"#000",weight:1,opacity:1,// alfa,
fillOpacity:1// alfa,
})},filter:dispatchFilter()}).addTo(map),"tsecs"==tipo&&(utToSecLayers={},secLayer.eachLayer(function(a){var b=a.feature.properties.sec,c=a.feature.properties.ut;utToSecLayers.hasOwnProperty(c)?utToSecLayers[c].push(a):utToSecLayers[c]=[a]})),resetSelection()}function flyToFocus(){var a=secLayer.getBounds();if(a.isValid()){var b=document.querySelector(".leaflet-sidebar-content").getBoundingClientRect().width;map.flyToBounds(a,{paddingTopLeft:[b,0]})}}function dispatchStyle(){return"uts"===tipo?utsStyle:"tsecs"===tipo?secStyle:plainStyle}function dispatchFilter(){return defFilter?defsFilter:function(){return!0}}var onClickGeom=function(a,b){undoSelection(),selectedSec=a.properties,selectedLayer=b,doSelection();var c=document.getElementById("sec-table");c.innerHTML="uts"==tipo?tableHTML_UTS(selectedSec):tableHTML(selectedSec),sidebar.open("datos")},clickHandler=function(a,b){return function(c){L.DomEvent.stop(c),onClickGeom(a,b)}};function callbackInstall(){return function(a,b){b.on({click:clickHandler(a,b)})}}var def_colors=["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#EDAD08","#E17C05","#CC503E","#94346E","#6F4070","#994E95","#666666"];function utsStyle(a){return{color:"#000000",weight:1,opacity:1,// alfa,
fill:!0,fillColor:def_colors[a.properties.def-1],fillOpacity:alfa}}function secStyle(a){var b=a.properties.sede==a.properties.sec?def_colors[8]:a.properties.sede?def_colors[10]:def_colors[11];return{color:"#000000",weight:1,opacity:1,// alfa,
fill:!0,fillColor:b,fillOpacity:alfa}}function plainStyle(){return{color:"#000000",weight:1,opacity:1,// alfa,
fill:!0,fillColor:"#b5261e",fillOpacity:alfa}}function defsFilter(a){return!("todos"!=defFilter)||+defFilter==a.properties.def}function filtraDEF(a){defFilter=a.target.value,setupMap(),setupBaseMap(),flyToFocus()}function filtraTipo(a){tipo=a.target.value,setupMap(),setupBaseMap()}function cambiaAlpha(a){alfa=+a.target.value/100,setupMap(),setupBaseMap()}function tableHTML(a){var b=a.def,c=a.mesas,d=a.mun,e=a.sec,f=a.secs,g=a.sede,h=a.ut,i=h.split("_")[1],j=f.length?f.join(", "):"??",k=a.domicilio,l=a.ubicacion,m=a.referencia,n="\n<h2>Secci\xF3n ".concat(e,"</h2>\n<br />\n<div class=\"info-row\">\n<div><strong>Unidad territorial</strong> <span>").concat(i,"</span></div>\n<div><strong>Distrito</strong> <span>").concat(b,"</span></div>\n<div><strong>Municipio sede</strong> <span>").concat(d,"</span></div>\n<div><strong>Secci\xF3n sede</strong> <span>").concat(g?g:"??","</span></div>\n</div>\n<div class=\"info-row\">\n<div><strong>Secciones en UT</strong> <span>").concat(j,"</span></div>\n</div>\n  ");if(c.length){n+="\n<div class=\"mesas\">\n<hr>\n<h3>Mesas receptoras</h3>\n<div class=\"mesas-row\">\n<div><strong>Domicilio</strong> <span>".concat(k,"</span></div>\n<div><strong>Ubicaci\xF3n</strong> <span>").concat(l,"</span></div>\n<div><strong>Referencia</strong> <span>").concat(m,"</span></div>\n</div>\n    ");var o,p=_createForOfIteratorHelper(c);try{for(p.s();!(o=p.n()).done;){var q=o.value,r="B"==q.casilla?"B\xE1sica":"Contigua "+ +q.casilla.substr(1);n+="\n<div class=\"mesas-row\">\n<h4>".concat(r,"</h4>\n<div><strong>Desde</strong> <span>").concat(q.inicial,"</span></div>\n<div><strong>Hasta</strong> <span>").concat(q.final,"</span></div>\n</div>\n      ")}}catch(a){p.e(a)}finally{p.f()}n+="\n</div>\n    "}return n}function tableHTML_UTS(a){var b=a.def,c=a.mesas,d=a.mun,e=a.secs,f=a.sede,g=a.ut,h=g.split("_")[1],i=e.length?e.join(", "):"??",j=a.domicilio,k=a.ubicacion,l=a.referencia,m="\n<h2>Unidad Territorial ".concat(h," del distrito ").concat(b,"</h2>\n<br />\n<div class=\"info-row\">\n<div><strong>Municipio sede</strong> <span>").concat(d,"</span></div>\n<div><strong>Secci\xF3n sede</strong> <span>").concat(f?f:"??","</span></div>\n</div>\n<div class=\"info-row\">\n<div><strong>Secciones en UT</strong> <span>").concat(i,"</span></div>\n</div>\n  ");if(c.length){m+="\n<div class=\"mesas\">\n<hr>\n<h3>Mesas receptoras</h3>\n<div class=\"mesas-row\">\n<div><strong>Domicilio</strong> <span>".concat(j,"</span></div>\n<div><strong>Ubicaci\xF3n</strong> <span>").concat(k,"</span></div>\n<div><strong>Referencia</strong> <span>").concat(l,"</span></div>\n</div>\n    ");var n,o=_createForOfIteratorHelper(c);try{for(o.s();!(n=o.n()).done;){var p=n.value,q="B"==p.casilla?"B\xE1sica":"Contigua "+ +p.casilla.substr(1);m+="\n<div class=\"mesas-row\">\n<h4>".concat(q,"</h4>\n<div><strong>Desde</strong> <span>").concat(p.inicial,"</span></div>\n<div><strong>Hasta</strong> <span>").concat(p.final,"</span></div>\n</div>\n      ")}}catch(a){o.e(a)}finally{o.f()}m+="\n</div>\n    "}return m}function volarSeccion(){var a,b=+document.getElementById("vuelo").value,c=_createForOfIteratorHelper(secLayer.getLayers());try{for(c.s();!(a=c.n()).done;){var d=a.value;if(d.feature.properties.sec==b){onClickGeom(d.feature,d);var e=d.getBounds();if(e.isValid()){var f=document.querySelector(".leaflet-sidebar-content").getBoundingClientRect().width;map.flyToBounds(e,{paddingTopLeft:[f,0]})}return}}}catch(a){c.e(a)}finally{c.f()}}
